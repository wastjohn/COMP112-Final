---
title: "main"
author: "WillStJohn"
date: "2022-11-04"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(lubridate)
library(rvest)
library(stringr)
library(ggplot2)
library(readr)
library(ggpubr)
library(plotly)
library(flexdashboard)

majors <- read_csv("https://raw.githubusercontent.com/wastjohn/COMP112-Final/main/majordata.csv")

#save first gen's as their own dataset
f_gen <- majors %>%
  filter(first_gen == 'first gen')
```

# First Generation Macalester College Majors

### What do we mean by "First Generation?" *A note about the data*

First generation college students are students who are the first in their family to attend college. In terms of this research, first generation students are those who identify as "first gen" on Macalester forms utilized by Macalester's Institutional Research office. *The Institutional Research office provided us with the data set used in this research.*

Now that we know where the data is coming from, let's clarify what it means to be a first gen student as it relates to the data.

The Mac major data contains around 2500 units of observation, with a little more than 60 variables for each observation. The units of observation themselves are individual students that graduated from Macalester College between the Fall of 2013 and the Spring of 2018. The variables themselves contain information such as graduation year, sex, major(s), whether or not they are a first generation student, and whether or not they studied away.

Our primary focus of this research was with students who identified as "first gen" compared to the entire data.

### What do first gen students look like?

How does the subsection of first gen students compare with the rest of the data?

Surprisingly, most of the data has no information about whether or not a student is a first generational student or not. With what information is available, there are fewer first gen students than students who are not first gen.

```{r, echo=FALSE}
#How many first gen students are in the dataset?
ggplot(majors, aes(x=first_gen)) +
  geom_bar()
```

#### Graduation Year

```{r, echo=FALSE}
#When do first gen's graduate?
fgen_year_plot <- ggplot(f_gen, aes(x = grad_year)) +
  geom_bar() +
  labs(title = 'First Generation Graduations Per Year', x = '', y = '')

year_plot <- ggplot(majors, aes(x = grad_year, fill = grad_year)) +
  geom_bar() + 
  labs(title = 'All Macalester Graduations Per Year', x = '', y = '')

year_fig <- ggarrange(fgen_year_plot, year_plot, ncol = 2)
annotate_figure(year_fig, 
                top = '', 
                bottom = 'Graduation Year', 
                left = 'Count', 
                right = '')
```

#### Sex

```{r, echo=FALSE}
#What sex did first gens identify as?
fgen_sex_plot <- ggplot(f_gen, aes(x = sex)) +
  geom_bar()

sex_plot <- ggplot(majors, aes(x = sex)) +
  geom_bar()

sex_fig <- ggarrange(fgen_sex_plot, sex_plot, ncol = 2)

annotate_figure(sex_fig, 
                top = 'Year', 
                bottom = 'Bottom', 
                left = 'Left', 
                right = 'Right')
```

#### Studied Away

```{r, echo=FALSE}
#How many first gens studied away?
fgen_sa_plot <- ggplot(f_gen, aes(x = studied_away)) +
  geom_bar()

sa_plot <- ggplot(majors, aes(x = studied_away)) +
  geom_bar()

sa_fig <- ggarrange(fgen_sa_plot, sa_plot, ncol = 2)

annotate_figure(sa_fig, 
                top = 'Year', 
                bottom = 'Bottom', 
                left = 'Left', 
                right = 'Right')
```

#### More Than One Major?

```{r, echo=FALSE}
#how many majors did first gens have?
ggplot(f_gen, aes(x = major_ct)) +
  geom_bar()

#What were first gen's first majors?
ggplot(f_gen, aes(y = major1, fill = major1_division)) +
  geom_bar()

#what were first gen's second majors?
ggplot(f_gen, aes(y = major2, fill = major2_division)) +
  geom_bar()

#what were first gen's third majors?
ggplot(f_gen, aes(x = major3)) +
  geom_bar()
```






```{r, echo=FALSE}
library(rpart)
library(rpart.plot)

head(majors)


first_gen_major <- majors %>% 
  drop_na(first_gen)
  
shuffle_index <- sample(1:nrow(first_gen_major))

first_gen_major <- first_gen_major[shuffle_index, ]

clean_first_gen <- first_gen_major %>%
  select(c(first_gen, sex, tot_enroll_ct, prefix_count, major1_division))

create_train_test <- function(data, size = 0.8, train = TRUE) {
    n_row = nrow(data)
    total_row = size * n_row
    train_sample <- 1:total_row
    if (train == TRUE) {
        return (data[train_sample, ])
    } else {
        return (data[-train_sample, ])
    }
}

data_train <- create_train_test(clean_first_gen, 0.8, train = TRUE)

data_test <- create_train_test(clean_first_gen, 0.8, train = FALSE)

fit <- rpart(sex~., data = data_train, method = "class")

rpart.plot(fit, extra = 106)
```



#interesting general information about first gens that could help with future questions 
summary(f_gen) #no first gen students majored in geology, theater and dance, spanish/portuguese, etc


```{r}
#make as many plots as you can

head(majors)

ggplot(majors, aes(y = major1)) +
  geom_bar() +
  facet_grid(~first_gen)

ggplot(majors, aes(y = major2)) +
  geom_bar()

ggplot(f_gen, aes(y = major2)) +
  geom_bar()

ggplot(majors, aes(y = major1_division)) +
  geom_bar()

head(f_gen)

f_gen %>%
  group_by(admit_type) %>%
  summarize(cnt = n())

ggplot(f_gen, aes(x = studied_away)) +
  geom_bar()

ggplot(f_gen, aes(x = major_ct)) +
  geom_bar()

ggplot(f_gen, aes(y = major1)) +
  geom_bar()

ggplot(f_gen, aes(y = major2)) +
  geom_bar()

ggplot(f_gen, aes(y = major1_division)) +
  geom_bar()

ggplot(f_gen, aes(y = major2_division)) +
  geom_bar()

ggplot(f_gen, aes(y = Conc1Desc)) +
  geom_bar()

ggplot(f_gen, aes(y = Conc2Desc)) +
  geom_bar()

#Devi's code
majors %>%
  filter(first_gen != "NA") %>%
  select(sex, first_gen) %>%
  count(sex, first_gen) %>%
  ggplot(aes(x = first_gen, y = n)) +
  geom_col() + facet_wrap(~sex) + theme_classic()
majorstd <- majors %>%
  filter(first_gen == "first gen") %>%
  select(major1, studied_away, sex)
ggplot(majorstd, aes(y = major1, x = studied_away)) +
  geom_col() + facet_wrap(~sex) +
  labs(x = "Number of Students Studying Away", y = "Type of Major", title = "First generation students per major studying away from 2014 to 2018") + theme_classic()
majors %>%
  select(first_gen, terms_enrl_ct) %>%
  count(first_gen, terms_enrl_ct) %>%
  ggplot(aes(x = terms_enrl_ct, y = n, fill = first_gen)) +
  geom_col(position = "fill") + theme_classic()
```



